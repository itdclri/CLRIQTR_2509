@model IEnumerable<CLRIQTR.Models.EmpMastTest>
@{
    ViewBag.Title = "SERC Employee List";
    int currentPage = ViewBag.CurrentPage ?? 1;
    int pageSize = ViewBag.PageSize ?? 25;
    int totalCount = ViewBag.TotalCount ?? 0;
    int totalPages = ViewBag.TotalPages ?? 1;
}

<!-- Horizontal Menu Bar -->
<nav class="navbar navbar-expand navbar-light bg-light mb-4">
    <div class="container">
        <ul class="navbar-nav me-auto">

            <li class="nav-item">
                <a class="nav-link" href="@Url.Action("Index", "Admin")">Home</a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="@Url.Action("GenerateTentativeReport", "Admin")">Generate Tentative Report</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" aria-current="page" href="@Url.Action("GenerateFinalReport", "Admin")">Generate Final Report</a>
            </li>

            <li class="nav-item">
                <a class="nav-link" aria-current="page" href="@Url.Action("Rule", "Admin")">Rule 10.1</a>
            </li>
        </ul>
    </div>
</nav>

<div class="index-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
    <div class="right-search-section" style="flex-grow: 1; margin-left: 20px;">
        @using (Html.BeginForm("SERC", "Admin", FormMethod.Get, new { @class = "filter-form", style = "display: flex; align-items: center; gap = 10px; flex-wrap: wrap;" }))
        {
            <div class="form-group">
                <label for="EmpNo" style="margin-bottom: 0;">Employee Number</label>
                <input type="text" name="EmpNo" class="form-control" placeholder="Search Employee No" value="@ViewBag.EmpNoFilter" style="min-width: 120px;" />
            </div>

            <div class="form-group">
                <label for="EmpName" style="margin-bottom: 0;">Employee Name</label>
                <input type="text" name="EmpName" class="form-control" placeholder="Search Employee  Name" value="@ViewBag.EmpNameFilter" style="min-width: 150px;" />
            </div>

            <div class="form-group">
                <label for="Designation" style="margin-bottom: 0;">Designation</label>
                @Html.DropDownList("Designation", (SelectList)ViewBag.DesignationList, "-- All --", new { @class = "form-control", style = "min-width: 150px;" })
            </div>


            var statusList = new List<SelectListItem>
{
        new SelectListItem { Text = "-- All --", Value = "" },
new SelectListItem { Text = "Occupied", Value = "Occupied" },
new SelectListItem { Text = "Not Occupied", Value = "Not Occupied" }
    };


<div class="form-group">
    <label for="Status" style="margin-bottom: 0;">Status</label>
    @Html.DropDownList("Status", statusList, new { @class = "form-control", style = "min-width: 150px;" })
</div>

<label style="font-size: 11px; margin-right: 4px;">Records</label>
<select name="pageSize" style="width: 50px; font-size: 11px; padding: 1px 2px; height: 24px;">
    <option value="10" @(pageSize == 10 ? "selected" : "")>10</option>
    <option value="20" @(pageSize == 20 ? "selected" : "")>20</option>
    <option value="30" @(pageSize == 30 ? "selected" : "")>30</option>
</select>




<div class="button-group" style="display: flex; flex-direction: column; gap: 6px;">
    <input type="submit" value="Search" class="btn btn-secondary btn-sm" />
    <a href="@Url.Action("SERC")" class="btn btn-light btn-sm">Reset</a>
</div>
}
    </div>
</div>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap;">
    <div class="button-group" style="display: flex; gap: 10px; flex-wrap: wrap;">
        <a href="@Url.Action("Create", "Admin")" class="btn btn-primary">Add Employee</a>

        @if (Convert.ToInt32(Session["LabCode"] ?? 0) == 100)
        {
            <a href="@Url.Action("Index", "Admin")" class="btn btn-outline-secondary" id="btnCLRI">CLRI</a>


            <a href="@Url.Action("SERC", "Admin")" class="btn btn-outline-secondary" id="btnSERC"
               style="color: #007bff; border-color: #007bff; background-color: transparent; transition: background-color 0.3s;">
                SERC
            </a>

            <a href="@Url.Action("CMC", "Admin")" class="btn btn-outline-secondary" id="btnCMC">CMC</a>

        }




    </div>

    <div class="results-count mt-2 mt-md-0">
        Showing @((currentPage - 1) * pageSize + 1) to @Math.Min(currentPage * pageSize, totalCount) of @totalCount Employees
    </div>
</div>


<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Emp No</th>
            <th>Name</th>
            <th>Designation</th>
            <th>DOB</th>
            <th>DOJ</th>
            <th>Active</th>
            @*<th>Status</th>*@
            <th style="width: 140px;">Actions</th>
        </tr>
    </thead>
    <tbody>
        @if (Model != null && Model.Any())
        {
            foreach (var item in Model)
            {
                <tr>
                    <td>@item.EmpNo</td>
                    <td>@item.EmpName</td>
                    <td>@item.DesDesc</td>
                    <td>@item.DOB</td>
                    <td>@item.DOJ</td>
                    <td>@(item.Active == "Y" ? "Yes" : "No")</td>
                    @*<td>
                                          @(item.QtrStatus == "O" ? "Occupied" :
                        item.QtrStatus == "V" ? "Vacant" : "")
                                      </td>*@

                    <td>
                        <div class="action-buttons">
                            <button type="button" class="btn btn-sm btn-success view-btn" data-empno="@item.EmpNo">View</button>
                            <a href="@Url.Action("UpdateQuarterDetails", "Admin", new { empNo = item.EmpNo })" class="btn btn-sm btn-info">Update Quarter</a>

                        </div>
                    </td>

                </tr>
            }
        }
        else
        {
            <tr><td colspan="7" class="text-center">No employees found</td></tr>
        }
    </tbody>
</table>

<!-- Pagination -->
@if (totalPages > 1)
{
    <nav aria-label="Page navigation">
        <ul class="pagination">

            <!-- Previous Page -->
            <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                <a class="page-link" href="@Url.Action("SERC", new {
                    EmpNo = ViewBag.EmpNoFilter,
EmpName = ViewBag.EmpNameFilter,
Designation = ViewBag.DesignationFilter,
Status = ViewBag.StatusFilter,
                    page = currentPage - 1,
                    pageSize = pageSize
                })">Previous</a>
            </li>

            <!-- First Page -->
            @if (currentPage > 3)
            {
                <li class="page-item">
                    <a class="page-link" href="@Url.Action("SERC", new {
                        EmpNo = ViewBag.EmpNoFilter,
EmpName = ViewBag.EmpNameFilter,
Designation = ViewBag.DesignationFilter,
Status = ViewBag.StatusFilter,
                        page = 1,
                        pageSize = pageSize
                    })">1</a>
                </li>
                <li class="page-item disabled"><span class="page-link">...</span></li>
            }

            <!-- Page Numbers around current -->
            @for (int i = currentPage - 2; i <= currentPage + 2; i++)
            {
                if (i > 0 && i <= totalPages)
                {
                    <li class="page-item @(i == currentPage ? "active" : "")">
                        <a class="page-link" href="@Url.Action("SERC", new {
                            EmpNo = ViewBag.EmpNoFilter,
EmpName = ViewBag.EmpNameFilter,
Designation = ViewBag.DesignationFilter,
Status = ViewBag.StatusFilter,
                            page = i,
                            pageSize = pageSize
                        })">@i</a>
                    </li>
                }
            }

            <!-- Last Page -->
            @if (currentPage < totalPages - 2)
            {
                <li class="page-item disabled"><span class="page-link">...</span></li>
                <li class="page-item">
                    <a class="page-link" href="@Url.Action("SERC", new {
                       EmpNo = ViewBag.EmpNoFilter,
EmpName = ViewBag.EmpNameFilter,
Designation = ViewBag.DesignationFilter,
Status = ViewBag.StatusFilter,
                        page = totalPages,
                        pageSize = pageSize
                    })">@totalPages</a>
                </li>
            }

            <!-- Next Page -->
            <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                <a class="page-link" href="@Url.Action("SERC", new {
                    EmpNo = ViewBag.EmpNoFilter,
                    EmpName = ViewBag.EmpNameFilter,
                    Designation = ViewBag.DesignationFilter,
                    page = currentPage + 1,
                    pageSize = pageSize
                })">Next</a>
            </li>
        </ul>
    </nav>
}

<!-- Modal for Employee Details -->
<div class="modal fade" id="empDetailsModal" tabindex="-1" role="dialog" aria-labelledby="empDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="empDetailsModalLabel">Employee Details</h5>
                <button type="button" class="close text-danger" id="modalCloseBtn" data-dismiss="modal" aria-label="Close" style="font-size: 1.5rem;">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="empDetailsContent">
                    <p>Loading...</p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.view-btn').click(function () {
                var empNo = $(this).data('empno');
                $('#empDetailsContent').html('<p>Loading...</p>');

                $.ajax({
                    url: '@Url.Action("ViewEmployeeDetails", "Admin")',
                    type: 'GET',
                    data: { empNo: empNo },
                    success: function (result) {
                        $('#empDetailsContent').html(result);
                        $('#empDetailsModal').modal('show');
                    },
                    error: function () {
                        $('#empDetailsContent').html('<p class="text-danger">Error loading details.</p>');
                        $('#empDetailsModal').modal('show');
                    }
                });
            });

            // Fallback close handler in case data-dismiss fails
            $('#modalCloseBtn').on('click', function () {
                $('#empDetailsModal').modal('hide');
            });

            function reloadPage() {
                location.reload();
            }

        });
    </script>
}
